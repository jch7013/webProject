define(["https://misc.360buyimg.com/m/fashion/1.0.0/js/trimPath.js"],function(){var e={"api":"https://api.m.jd.com/client.action?functionId=","productUrl":"queryMatProdsForGrps","goodsAppAddress":"https://item.m.jd.com/ware/view.action?wareId=","goodsWqAddress":"https://wqitem.jd.com/item/view?sku=","srcInitPic":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII=","uuid":(new Date).getTime()+97531};function a(i){var h=$(window).height(),g=i.height(),f=e.srcInitPic,j=i.offset().top-(document.documentElement.scrollTop+document.body.scrollTop);if(i.attr("src")==f&&j<=h&&j>-g){i.attr({"src":i.attr("data-src"),"data-src":""});i.css("opacity",1)}}function d(){try{return(document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")==0)}catch(f){return false}}function b(g,f){$.ajax({url:g,dataType:"jsonp",timeout:5000,jsonp:"callback",jsonpCallback:"jsonpCallback"+new Date().getTime(),success:function(h){f(h)},error:function(h){console.log(h)}})}var c={isAppAddress:function(){return !!location.pathname.match(/^\/mall\//)},isWQAddress:function(){return !!location.pathname.match(/^\/wq\//)}};return{slideStyle:function(i){var f=$("#"+i.ele),h="";h=(c.isWQAddress()?e.goodsWqAddress:e.goodsAppAddress);webpType=(d()?"":"");var g='{for list in stageList}{for item in list.productList}<li><div class="goodsPic"><a class="J_ping" href="'+h+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+i.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+i.pageUrl+'" report-eventlevel="3"><img {if (item_index<4)} src="${item.image}" data-src="" style="opacity:1;"{else} src="'+e.srcInitPic+'" data-src="${item.image}'+webpType+'" {/if}></a></div><div class="goodsName"><a class="J_ping" href="'+h+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+i.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+i.pageUrl+'" report-eventlevel="3">${item.name}</a></div><div class="goodsYsPrice"><a class="J_ping" href="'+h+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+i.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+i.pageUrl+'" report-eventlevel="3"><span class="ys-price">{if (item.prePrice=="")}京东价:￥${item.pPrice}{else}预售价:￥${item.prePrice}{/if}</span></a></div><div class="goodsPrice"><a class="J_ping" href="'+h+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+i.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+i.pageUrl+'" report-eventlevel="3"><span class="p-price {if (item.prePrice=="")}hide{/if}">${item.appoints}件已预订</span></a></div><div class="dingjin"><a class="J_ping" href="'+h+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+i.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+i.pageUrl+'" report-eventlevel="3">{if (item.prePrice=="")}立即购买{else}预付${item.depDisc}元抵${item.depWorth}元{/if}</a></div></li>{/for}{/for}';var j=e.api+e.productUrl+'&body={"ids":"'+i.id+'","currentStageFlag":"Y","sourceCode":"jshop"}&client=wh5&clientVersion=1.0.0&sid=&uuid='+e.uuid;b(j,function(k){var l=k.groupList[0];if("success"==k.returnMsg&&l.stageList[0].productList&&l.stageList[0].productList.length>0){f.html(g.process(l))}})},tabStyle:function(h){var n=[],k="",m=h.data,g=$("#"+h.ele),p="",j=e.goodsAppAddress;var f='<div class="tab-wraper"><ul class="presale-tabs"></ul></div><div class="presale-content"></div>';g.html(f);j=(c.isWQAddress()?e.goodsWqAddress:e.goodsAppAddress);p=(d()?"":"");var i="";m.map(function(r,l){if(m.length<5){i=(100/m.length)+"%"}else{i="21.222vw"}k+='<li style="width:'+i+';" data-id="'+r.id+'">'+r.name+"</li>";n.push(r.id)});g.find(".presale-tabs").append(k);g.find(".presale-tabs li").eq(0).addClass("ysTabsCur");var q='{for list in groupList}<ul class="presale-item" data-flTabs="${list.groupId}">{for item in list.stageList[0].productList}<li class="goods-item"><div class="goodsPic"><a class="J_ping" href="'+j+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+h.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+h.pageUrl+'" report-eventlevel="3"><img src="'+e.srcInitPic+'" data-src="${item.image}'+p+'"></a></div><div class="goodsName"><a class="J_ping" href="'+j+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+h.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+h.pageUrl+'" report-eventlevel="3">${item.name}</a></div><div class="goodsYsPrice"><a class="J_ping" href="'+j+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+h.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+h.pageUrl+'" report-eventlevel="3"> <span class="ys-price">{if (item.prePrice=="")}京东价:￥${item.pPrice}{else}预售价:￥${item.prePrice}{/if}</span></a></div><div class="goodsPrice"><a class="J_ping" href="'+j+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+h.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+h.pageUrl+'" report-eventlevel="3"><span class="yuding-num {if (item.prePrice=="")}hide{/if}">${item.appoints}件已预订</span><span class="p-price">上市价:￥${item.pcpPrice}</span></a></div><div class="dingjin"><a class="J_ping" href="'+j+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+h.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+h.pageUrl+'" report-eventlevel="3">{if (item.prePrice=="")}立即购买{else}预付${item.depDisc}元抵${item.depWorth}元{/if}</a></div></li>{/for}</ul>{/for}';
var o=e.api+e.productUrl+'&body={"ids":"'+n.join(",")+'","currentStageFlag":"Y","sourceCode":"jshop"}&client=wh5&clientVersion=1.0.0&sid=&uuid='+e.uuid;b(o,function(l){if("success"==l.returnMsg&&l.groupList&&l.groupList.length>0){var r=l;g.find(".presale-content").html(q.process(r));g.find('.presale-content ul[data-flTabs="'+n[0]+'"]').show().find("img").each(function(){a($(this))});g.find(".presale-tabs li").on("tap",function(v){var x=$(this),u=x.index(),t=x.width();var s=g.find('.presale-content ul[data-flTabs="'+n[u]+'"]');x.addClass("ysTabsCur").siblings().removeClass("ysTabsCur");require(["https://storage.360buyimg.com/babel/00067765/175382/active/scrollTabToL.min.js"],function(w){g.find(".presale-tabs").scrollTabToL({toL:t*(u-2)})});s.show().siblings().hide();s.find("img").each(function(){a($(this))})});require(["https://storage.360buyimg.com/babel/00067765/175382/active/scrollSticky.min.js"],function(u){var v=g.find(".tab-wraper");var s=g.find(".presale-tabs");$.initSticky({stickyNode:v,fixedNode:s,top:0,zIndex:100,fixedClazz:"fixed",runInScrollFn:t});function t(){var w=$(window).scrollTop();var z=g.height();var x=g.offset().top;var y=g.offset().top+z;if(Math.floor(x)<=w&&Math.floor(y)>w){s.addClass("fixed")}else{s.removeClass("fixed")}}})}})},listStyle:function(j){var f=$("#"+j.ele),i="";i=(c.isWQAddress()?e.goodsWqAddress:e.goodsAppAddress);webpType=(d()?"":"");var h='<div class="presale-content"><ul class="presale-item" style="display:block;"></ul></div>';f.html(h);var g='{for list in stageList}{for item in list.productList}<li class="goods-item"><div class="goodsPic"><a class="J_ping" href="'+i+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+j.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+j.pageUrl+'" report-eventlevel="3"><img src="'+e.srcInitPic+'" data-src="${item.image}'+webpType+'"></a></div><div class="goodsName"><a class="J_ping" href="'+i+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+j.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+j.pageUrl+'" report-eventlevel="3">${item.name}</a></div><div class="goodsYsPrice"><a class="J_ping" href="'+i+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+j.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+j.pageUrl+'" report-eventlevel="3"> <span class="ys-price">{if (item.prePrice=="")}京东价:￥${item.pPrice}{else}预售价:￥${item.prePrice}{/if}</span></a></div><div class="goodsPrice"><a class="J_ping" href="'+i+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+j.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+j.pageUrl+'" report-eventlevel="3"><span class="yuding-num {if (item.prePrice=="")}hide{/if}">${item.appoints}件已预订</span><span class="p-price">上市价:￥${item.pcpPrice}</span></a></div><div class="dingjin"><a class="J_ping" href="'+i+'${item.skuId}&clickUrl=" target="_self" report-eventid="Babel_dev_sku" report-eventparam="'+j.activityId+'_${item.skuId}_${list.groupId}_null_${item_index}" report-pagename="http:'+j.pageUrl+'" report-eventlevel="3">{if (item.prePrice=="")}立即购买{else}预付${item.depDisc}元抵${item.depWorth}元{/if}</a></div></li>{/for}{/for}';var k=e.api+e.productUrl+'&body={"ids":"'+j.id+'","currentStageFlag":"Y","sourceCode":"jshop"}&client=wh5&clientVersion=1.0.0&sid=&uuid='+e.uuid;b(k,function(l){var m=l.groupList[0];if("success"==l.returnMsg&&m.stageList[0].productList&&m.stageList[0].productList.length>0){f.find(".presale-item").html(g.process(m)).find("img").each(function(){a($(this))})}})}}});